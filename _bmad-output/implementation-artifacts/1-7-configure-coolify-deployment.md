# Story 1.7: Configure Coolify Deployment

Status: done

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a **developer**,
I want **Coolify configured to auto-deploy the application on push to main**,
So that **changes are automatically deployed to the VPS without manual intervention**.

## Acceptance Criteria

**Given** Coolify is installed on the target VPS
**When** the deployment configuration is complete
**Then** the project is connected to Coolify with:

- Git repository linked for auto-deployment
- Environment variables configured (DATABASE_PATH, SESSION_SECRET, TELEGRAM_BOT_TOKEN, etc.)
- Docker Compose deployment method selected
- Volume mounts configured for SQLite database persistence and backups

**And** pushing to main branch triggers automatic deployment

**And** deployment logs are visible in Coolify dashboard

**And** the application is accessible at the configured domain

**And** SQLite database persists across deployments via volume mount

**And** backup script configured with cron job for daily automated backups (30-day retention)

## Tasks / Subtasks

- [x] Connect Git repository to Coolify (AC: Auto-deployment on push to main)

  - [x] Add GitHub repository to Coolify
  - [x] Configure automatic deployment trigger on main branch
  - [x] Verify webhook configuration for GitHub
  - [x] Test deployment trigger with test commit

- [x] Configure environment variables in Coolify (AC: All required secrets configured)

  - [x] Set DATABASE_PATH=/data/finance.db
  - [x] Set SESSION_SECRET (generate secure random value)
  - [x] Set TELEGRAM_BOT_TOKEN (from BotFather)
  - [x] Set NODE_ENV=production
  - [x] Set FRONTEND_URL (domain or IP)
  - [x] Verify all variables are encrypted in Coolify database

- [x] Configure persistent storage volumes (AC: Data persists across deployments)

  - [x] Create volume mount for SQLite database: /data → /data
  - [x] Create volume mount for backups: /backups → /backups
  - [x] Verify volume UUID generated by Coolify
  - [x] Verify data directory permissions in container

- [x] Configure Docker Compose deployment method (AC: Coolify uses docker-compose.yml)

  - [x] Select Docker Compose build pack in Coolify
  - [x] Verify Coolify reads docker-compose.yml from repository
  - [x] Ensure no port configuration in compose file (Coolify manages ports)
  - [x] Ensure no network configuration in compose file (Coolify manages networks)
  - [x] Configure domain/port for Nginx service

- [x] Create backup script and cron job (AC: Daily automated backups with 30-day retention)

  - [x] Write backup.sh script to copy SQLite database
  - [x] Add backup script to backend container or separate service
  - [x] Configure cron job for daily execution at 2am
  - [x] Implement 30-day retention cleanup logic
  - [x] Test backup script manually
  - [x] Verify backups written to /backups volume

- [x] Test complete deployment flow (AC: Full deployment works end-to-end)

  - [x] Push commit to main branch
  - [x] Verify Coolify triggers deployment
  - [x] Monitor deployment logs for errors
  - [x] Verify application accessible at domain
  - [x] Test frontend loads correctly
  - [x] Test API health endpoint /api/health
  - [x] Verify database persistence after redeployment
  - [x] Check Coolify logs for application output

- [x] Document deployment process (AC: Clear deployment documentation exists)
  - [x] Update README.md with Coolify deployment instructions
  - [x] Document environment variables required
  - [x] Document volume mount configuration
  - [x] Document backup/restore process
  - [x] Add troubleshooting section for common issues

## Dev Notes

### Critical Architecture Patterns

**Coolify Deployment Strategy from Architecture:**

- **Auto-deployment:** Git push to main triggers automatic Coolify deployment
- **Docker Compose:** Single docker-compose.yml as deployment configuration
- **Volume mounts:** SQLite database and backups persist via Coolify-managed volumes
- **Environment variables:** Managed in Coolify UI, encrypted in database, injected at runtime
- **Zero downtime:** Coolify handles container orchestration and health checks
- Source: [Architecture.md - Infrastructure & Deployment](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)

**CI/CD Pipeline Integration:**

- **GitHub Actions (Story 1.6):** Runs quality gates (type check, lint, build, test) on PR and push
- **Quality gates pass → Push to main → Coolify auto-deploys**
- If CI fails, no deployment occurs (branch protection blocks merge)
- Coolify deployment is the CD part of CI/CD pipeline
- Source: [Architecture.md - CI/CD Strategy](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)

**Privacy-First Architecture:**

- **Local VPS deployment:** No cloud services, complete data ownership
- **Encrypted secrets:** Environment variables stored encrypted in Coolify database
- **Local-only backups:** Backup retention on VPS only (no off-site for MVP)
- **No external dependencies:** Self-hosted Coolify instance, no third-party services
- Source: [Architecture.md - Security Requirements](/_bmad-output/planning-artifacts/architecture.md#authentication--security)

**Docker Compose Configuration (from Story 1.5):**

- Two services: backend (Node.js/Fastify) + nginx (frontend + reverse proxy)
- Health checks configured for backend service
- Named volumes: db-data, db-backups
- Bridge network for inter-service communication
- Source: [Story 1.5 - Docker Containerization](/_bmad-output/implementation-artifacts/1-5-configure-docker-containerization.md)

### Project Structure Notes

**Coolify-Specific Files and Configuration:**

```
finance-doctor/
├── docker-compose.yml            # EXISTING - Coolify reads this as deployment config
├── Dockerfile.backend            # EXISTING - Backend build
├── Dockerfile.frontend           # EXISTING - Frontend + nginx build
├── .env.example                  # EXISTING - Template for environment variables
├── scripts/                      # NEW - Deployment/maintenance scripts
│   └── backup.sh                 # NEW - Daily backup script
├── README.md                     # MODIFIED - Add Coolify deployment docs
└── .coolify/                     # OPTIONAL - Coolify-specific configs (if needed)
```

**Critical Coolify Best Practices (2026):**

**Port Management:**

- DO NOT expose ports in docker-compose.yml - Coolify manages ports automatically
- Remove `ports: - "80:80"` from compose file for Coolify deployment
- Coolify assigns dynamic ports and handles reverse proxy
- Source: [Coolify Docker Compose Build Packs](https://coolify.io/docs/applications/build-packs/docker-compose)

**Network Configuration:**

- DO NOT define networks in docker-compose.yml - Coolify creates networks automatically
- Remove `networks:` section from compose file for Coolify
- Coolify adds proxy service to internal network for routing
- Services communicate via Coolify-managed network
- Source: [Coolify Docker Compose Docs](https://coolify.io/docs/knowledge-base/docker/compose)

**Volume Configuration:**

- Define volumes in docker-compose.yml as named volumes
- Coolify adds resource UUID to volume names automatically
- Source path empty in Coolify UI, destination path in compose file
- Example: Coolify creates `finance-doctor-<uuid>_db-data` from `db-data` volume
- Source: [Coolify Persistent Storage](https://coolify.io/docs/knowledge-base/persistent-storage)

**Environment Variables:**

- Manage environment variables in Coolify UI, not in docker-compose.yml
- Coolify encrypts secrets in its database
- Variables injected into all containers via single .env file
- Security note: All containers see all variables in multi-container setups (current behavior)
- Source: [Coolify Environment Variables](https://coolify.io/docs/knowledge-base/environment-variables)

**Build Cache Optimization:**

- Disable "Include Source Commit in Build" for better build cache persistence
- SOURCE_COMMIT changes per commit and invalidates Docker layer cache
- Faster subsequent deployments with cache enabled
- Source: [Coolify Best Practices](https://dev.to/mandrasch/simple-coolify-example-with-docker-compose-github-deployments-53m)

### Technical Requirements

**Modified docker-compose.yml for Coolify Deployment:**

CRITICAL CHANGES needed for Coolify compatibility:

```yaml
# REMOVE ports section (Coolify manages ports)
# REMOVE networks section (Coolify creates networks)
# KEEP volumes section (Coolify adds UUID prefix)
# KEEP environment variables as references ${VAR} (Coolify injects values)

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: finance-doctor-backend
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - DATABASE_PATH=${DATABASE_PATH:-/data/finance.db}
      - SESSION_SECRET=${SESSION_SECRET}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - FRONTEND_URL=${FRONTEND_URL}
    volumes:
      - db-data:/data # Coolify creates finance-doctor-<uuid>_db-data
      - db-backups:/backups # Coolify creates finance-doctor-<uuid>_db-backups
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:3000/api/health",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  nginx:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: finance-doctor-nginx
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped
    # NO ports: section - Coolify manages this
    # NO networks: section - Coolify manages this

volumes:
  db-data:
    driver: local
  db-backups:
    driver: local
# NO networks section for Coolify deployment
```

**Coolify Configuration Steps:**

**1. Create New Resource in Coolify:**

- Navigate to Coolify dashboard
- Projects → New Project → "finance-doctor"
- Add Resource → Application → Git Repository

**2. Connect GitHub Repository:**

- Select GitHub as Git provider
- Authorize Coolify to access repository
- Choose repository: `<username>/finance-doctor`
- Select branch: `main`
- Auto-deployment: ENABLED
- Build Pack: Docker Compose

**3. Configure Environment Variables:**

In Coolify UI > Environment Variables tab:

| Variable           | Value                     | Type   | Notes                       |
| ------------------ | ------------------------- | ------ | --------------------------- |
| NODE_ENV           | production                | Normal | Node.js environment         |
| DATABASE_PATH      | /data/finance.db          | Normal | SQLite database path        |
| SESSION_SECRET     | (generate 64-char random) | Secret | Session encryption key      |
| TELEGRAM_BOT_TOKEN | (from BotFather)          | Secret | Telegram bot authentication |
| FRONTEND_URL       | https://yourdomain.com    | Normal | Frontend domain             |

Generate SESSION_SECRET with:

```bash
openssl rand -base64 48  # Generates 64-character random string
```

**4. Configure Persistent Storage (Coolify UI > Persistent Storage):**

**Database Volume:**

- Name: `db-data`
- Source: (leave empty, Coolify auto-generates path)
- Destination: `/data`
- Service: `backend`

**Backup Volume:**

- Name: `db-backups`
- Source: (leave empty, Coolify auto-generates path)
- Destination: `/backups`
- Service: `backend`

**5. Configure Domain and Networking:**

- Coolify UI > Networking tab
- Set domain: `finance-doctor.yourdomain.com` OR use IP address
- Enable HTTPS: Optional (Coolify can auto-provision Let's Encrypt)
- Select service to expose: `nginx`
- Coolify auto-configures Traefik reverse proxy

**6. Deployment Settings:**

- Build Settings > Include Source Commit: DISABLED (better cache)
- Deployment Type: Manual first deploy, then auto on push to main
- Health Check: Enabled (uses docker-compose healthcheck)
- Deployment timeout: 600 seconds (10 minutes)

**7. GitHub Webhook Configuration:**

Coolify automatically creates webhook when you connect repository. Verify:

- Coolify UI > Webhooks tab: Copy webhook URL
- GitHub Repository > Settings > Webhooks: Verify webhook exists
- Recent Deliveries: Check for successful responses
- If missing, manually add webhook:
  - Payload URL: `https://coolify.yourdomain.com/api/v1/deploy/webhook/<uuid>`
  - Content type: `application/json`
  - Events: `push` to main branch

**Backup Script Implementation:**

Create `scripts/backup.sh` in repository:

```bash
#!/bin/bash
# Daily SQLite backup script
# Runs via cron at 2am daily

BACKUP_DIR="/backups"
DB_PATH="/data/finance.db"
DATE=$(date +%Y%m%d-%H%M%S)
BACKUP_FILE="$BACKUP_DIR/finance-$DATE.db"
RETENTION_DAYS=30

# Create backup directory if it doesn't exist
mkdir -p "$BACKUP_DIR"

# Copy database file (SQLite handles concurrent reads safely)
if [ -f "$DB_PATH" ]; then
    cp "$DB_PATH" "$BACKUP_FILE"
    echo "$(date): Backup created: $BACKUP_FILE"
else
    echo "$(date): ERROR: Database file not found at $DB_PATH"
    exit 1
fi

# Remove backups older than retention period
find "$BACKUP_DIR" -name "finance-*.db" -type f -mtime +$RETENTION_DAYS -delete
echo "$(date): Old backups cleaned (>$RETENTION_DAYS days)"

# Verify backup file exists and has size > 0
if [ -s "$BACKUP_FILE" ]; then
    BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
    echo "$(date): Backup successful. Size: $BACKUP_SIZE"
    exit 0
else
    echo "$(date): ERROR: Backup file is empty or missing"
    exit 1
fi
```

**Cron Job Configuration:**

Add to backend Dockerfile or create separate cron container:

**Option 1: Add to backend container (Simpler, recommended for MVP)**

Modify `Dockerfile.backend` to include cron:

```dockerfile
# In Dockerfile.backend, add after dependencies install
RUN apt-get update && apt-get install -y cron && rm -rf /var/lib/apt/lists/*

# Copy backup script
COPY scripts/backup.sh /usr/local/bin/backup.sh
RUN chmod +x /usr/local/bin/backup.sh

# Add cron job
RUN echo "0 2 * * * /usr/local/bin/backup.sh >> /var/log/backup.log 2>&1" | crontab -

# Start cron and node app (requires process manager)
CMD cron && node dist/server.js
```

**Option 2: Separate cron service (Better separation, more complex)**

Add to docker-compose.yml:

```yaml
backup-cron:
  image: alpine:latest
  container_name: finance-doctor-backup-cron
  command: crond -f -l 2
  volumes:
    - db-data:/data:ro # Read-only access to database
    - db-backups:/backups # Write access to backups
    - ./scripts/backup.sh:/etc/periodic/daily/backup:ro
  environment:
    - TZ=America/New_York # Set timezone for cron
  restart: unless-stopped
```

**Recommendation for MVP:** Use Option 1 (add cron to backend) for simplicity. Can refactor to separate service later if needed.

### Architecture Compliance

**Coolify Deployment Architecture (January 2026):**

**How Coolify Works:**

- Coolify is a self-hosted Platform-as-a-Service (PaaS)
- Runs on your VPS, manages Docker deployments via Traefik reverse proxy
- Git-integrated: Monitors repository, triggers deployments on push
- Secrets management: Encrypted environment variables in Coolify database
- Logging: Captures container stdout/stderr, viewable in Coolify UI
- Source: [Coolify Documentation](https://coolify.io/docs/applications/)

**Deployment Flow:**

```
Developer pushes to main
    ↓
GitHub webhook triggers Coolify
    ↓
Coolify pulls latest code
    ↓
Coolify reads docker-compose.yml
    ↓
Coolify injects environment variables
    ↓
Coolify builds Docker images (multi-stage Dockerfiles)
    ↓
Coolify creates/updates containers
    ↓
Coolify configures Traefik reverse proxy
    ↓
Application accessible at domain
    ↓
Coolify monitors health checks
```

**Integration with CI/CD (Story 1.6):**

```
Developer creates PR
    ↓
GitHub Actions CI runs (type check, lint, test, build)
    ↓
CI passes → PR can be merged
CI fails → Merge blocked
    ↓
Developer merges PR to main
    ↓
GitHub Actions CI runs on main branch
    ↓
CI passes → Coolify webhook triggered
CI fails → Deployment prevented (no webhook on failure)
    ↓
Coolify deploys to VPS
    ↓
Application live in production
```

**Volume Persistence Mechanism:**

Coolify uses Docker named volumes with UUID prefixes:

```
docker-compose.yml declares: db-data
    ↓
Coolify creates: finance-doctor-<resource-uuid>_db-data
    ↓
Stored on VPS filesystem: /var/lib/docker/volumes/finance-doctor-<uuid>_db-data
    ↓
Mounted into container: /data
    ↓
SQLite database file: /data/finance.db
    ↓
Persists across container restarts, redeployments, updates
```

**Why this matters:**

- Data survives code redeployments
- Database file never deleted unless volume explicitly removed
- Backups in separate volume for extra safety
- Can manually access volumes on VPS if needed

**Environment Variable Security:**

Coolify's secrets management:

```
Developer adds variable in Coolify UI
    ↓
Coolify encrypts value in its database
    ↓
On deployment, Coolify decrypts variables
    ↓
Creates single .env file with all variables
    ↓
Injects .env file into all containers via env_file
    ↓
Node.js process reads process.env.VARIABLE_NAME
```

**Security Consideration:**
All containers in a Docker Compose project see all environment variables. This is current Coolify behavior. For finance-doctor with 2 services (backend + nginx), this is acceptable since nginx doesn't execute user code. Frontend environment variables should use `VITE_` prefix (build-time only, not runtime secrets).

### Library/Framework Requirements

**Coolify Platform (Self-Hosted):**

**Minimum Coolify Version:** v4.x (latest stable as of January 2026)

**Installation on VPS:**

```bash
# Official Coolify installation script
curl -fsSL https://cdn.coollabs.io/coolify/install.sh | bash

# After installation:
# - Coolify dashboard: http://<vps-ip>:8000
# - Default credentials: Check installation output
# - Configure domain, HTTPS, backups per Coolify docs
```

**Coolify Requirements:**

- Ubuntu 20.04+ or Debian 11+ (recommended)
- Minimum 2 CPU cores, 4GB RAM, 20GB storage
- Docker installed (Coolify installer handles this)
- Public IP or domain for webhook access

**No Additional Dependencies:**

This story uses existing infrastructure:

- Docker: Already configured (Story 1.5)
- docker-compose: Already configured (Story 1.5)
- GitHub repository: Already exists with CI/CD (Story 1.6)
- All services containerized: Frontend, backend, database

**Deployment Checklist:**

**Pre-deployment Requirements:**

- ✅ VPS with Coolify installed and accessible
- ✅ GitHub repository set up with main branch
- ✅ docker-compose.yml exists and tested locally
- ✅ Dockerfiles build successfully (Story 1.5 complete)
- ✅ CI/CD pipeline passing (Story 1.6 complete)
- ✅ .env.example committed with all required variables
- ✅ Domain or IP address for application access

**Coolify-Specific Packages:**

No additional npm packages required. Coolify is platform-only, not a code dependency.

**Backup Script Dependencies:**

Standard Unix utilities (already in Alpine/Ubuntu base images):

- `bash` (script execution)
- `cron` (scheduled tasks)
- `date` (timestamp generation)
- `cp` (file copy)
- `find` (retention cleanup)
- `du` (file size check)

**Telegram Bot Token:**

Required for production deployment:

1. Create bot via Telegram BotFather
2. Send `/newbot` command
3. Follow prompts to set bot name and username
4. Copy bot token (format: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
5. Add to Coolify environment variables as SECRET

### File Structure Requirements

**Files to Modify:**

**docker-compose.yml (MODIFY - Critical for Coolify):**

- REMOVE `ports:` section from nginx service
- REMOVE `networks:` section entirely
- KEEP `volumes:` section (Coolify adds UUID)
- VERIFY all environment variables use `${VAR}` syntax
- VERIFY health checks are properly configured

**README.md (MODIFY - Add deployment documentation):**
Add new section:

```markdown
## Deployment

### Coolify Deployment

This application is configured for automatic deployment via Coolify.

**Prerequisites:**

- Coolify v4.x installed on VPS
- GitHub repository connected to Coolify
- Environment variables configured in Coolify UI

**Required Environment Variables:**

- `NODE_ENV`: `production`
- `DATABASE_PATH`: `/data/finance.db`
- `SESSION_SECRET`: (generate with `openssl rand -base64 48`)
- `TELEGRAM_BOT_TOKEN`: (from BotFather)
- `FRONTEND_URL`: Your domain or IP

**Deployment Process:**

1. Push to `main` branch
2. Coolify automatically detects push via webhook
3. Builds Docker images from Dockerfiles
4. Deploys containers with environment variables
5. Application accessible at configured domain

**Persistent Data:**

- SQLite database: `/data/finance.db` (persisted via `db-data` volume)
- Backups: `/backups` directory (persisted via `db-backups` volume)
- Automated daily backups at 2am with 30-day retention

**Manual Deployment:**
In Coolify dashboard → Your Project → Deploy button

**View Logs:**
Coolify dashboard → Your Project → Logs tab

**Backup/Restore:**

- Backups: Automated daily, stored in `/backups` volume
- Manual backup: `docker exec finance-doctor-backend cp /data/finance.db /backups/manual-$(date +%Y%m%d).db`
- Restore: Copy backup file to `/data/finance.db` and restart container

**Troubleshooting:**

- Check Coolify logs for deployment errors
- Verify webhook deliveries in GitHub repository settings
- Ensure all environment variables are set in Coolify UI
- Test Docker build locally: `docker-compose up --build`
```

**.env.example (MODIFY - Add production guidance):**

Add comments for Coolify deployment:

```bash
# ===========================================
# Finance Doctor - Environment Variables
# ===========================================

# Instructions:
# - Local development: Copy this file to .env and fill in values
# - Production (Coolify): Configure in Coolify UI, not in .env file

# Application Environment
NODE_ENV=development        # production | development | test

# Database Configuration
DATABASE_PATH=./data/finance.db   # Local: relative path | Coolify: /data/finance.db

# Session Configuration
SESSION_SECRET=your-secret-key-here-minimum-32-characters
# Generate with: openssl rand -base64 48

# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
# Obtain from: https://t.me/BotFather

# Frontend URL (for CORS and redirects)
FRONTEND_URL=http://localhost   # Local | Coolify: https://yourdomain.com

# ===========================================
# Coolify Deployment Notes
# ===========================================
# - Set all variables in Coolify UI (Project > Environment Variables)
# - Mark SESSION_SECRET and TELEGRAM_BOT_TOKEN as "Secret" type
# - Coolify injects variables into containers at runtime
# - Never commit .env file to git (security risk)
```

**Files to Create:**

**scripts/backup.sh (CREATE):**

- Complete backup script (see Technical Requirements section above)
- Executable permissions: `chmod +x scripts/backup.sh`
- Daily execution via cron at 2am
- 30-day retention policy
- Error handling and logging

**scripts/restore.sh (CREATE - Optional but recommended):**

```bash
#!/bin/bash
# Restore SQLite database from backup
# Usage: ./restore.sh <backup-file>

if [ -z "$1" ]; then
    echo "Usage: $0 <backup-file>"
    echo "Example: $0 /backups/finance-20260110-020000.db"
    exit 1
fi

BACKUP_FILE="$1"
DB_PATH="/data/finance.db"

if [ ! -f "$BACKUP_FILE" ]; then
    echo "ERROR: Backup file not found: $BACKUP_FILE"
    exit 1
fi

# Backup current database before restore (safety)
if [ -f "$DB_PATH" ]; then
    cp "$DB_PATH" "$DB_PATH.before-restore-$(date +%Y%m%d-%H%M%S)"
    echo "Current database backed up to $DB_PATH.before-restore-*"
fi

# Restore from backup
cp "$BACKUP_FILE" "$DB_PATH"
echo "Database restored from: $BACKUP_FILE"
echo "IMPORTANT: Restart backend container for changes to take effect"
```

**Directory Structure After This Story:**

```
finance-doctor/
├── .github/
│   └── workflows/
│       └── ci.yml                    # Existing (Story 1.6)
├── frontend/                         # Existing (Story 1.2)
├── backend/                          # Existing (Story 1.3)
├── docker-compose.yml                # MODIFIED - Coolify compatibility
├── Dockerfile.backend                # MODIFIED (if adding cron)
├── Dockerfile.frontend               # Existing (Story 1.5)
├── scripts/                          # NEW - Deployment scripts
│   ├── backup.sh                     # NEW - Daily backup script
│   └── restore.sh                    # NEW - Manual restore script
├── .env.example                      # MODIFIED - Coolify guidance
├── README.md                         # MODIFIED - Deployment docs
└── .gitignore                        # Verify (no changes needed)
```

**Files to NEVER Commit:**

- ❌ `.env` (contains secrets)
- ❌ `*.db` (SQLite database files)
- ❌ `/data/` (database directory)
- ❌ `/backups/` (backup files)
- ❌ `node_modules/`

**Verify .gitignore includes:**

```gitignore
.env
*.db
data/
backups/
```

### Testing Requirements

**Manual Verification Steps:**

**1. Modify docker-compose.yml for Coolify:**

```bash
# Remove ports from nginx service
# Remove networks section
# Verify environment variables use ${VAR} syntax
```

**2. Test Modified Compose File Locally:**

```bash
# Create local .env file with test values
cp .env.example .env
# Edit .env with valid values

# Build and run services
docker-compose up --build

# Verify both services start successfully
# Test frontend: http://localhost (should fail without port mapping)
# Test backend: docker exec finance-doctor-backend wget http://localhost:3000/api/health

# Stop services
docker-compose down
```

**3. Create Backup Scripts:**

```bash
# Create scripts directory
mkdir -p scripts

# Create backup.sh (see Technical Requirements)
vim scripts/backup.sh

# Create restore.sh (see File Structure Requirements)
vim scripts/restore.sh

# Make executable
chmod +x scripts/backup.sh scripts/restore.sh

# Test backup script locally
docker-compose up -d backend
docker exec finance-doctor-backend /scripts/backup.sh
docker exec finance-doctor-backend ls -lh /backups
```

**4. Commit Coolify Configuration:**

```bash
git add docker-compose.yml
git add scripts/backup.sh scripts/restore.sh
git add README.md .env.example
git commit -m "feat: configure coolify deployment"
git push origin main
```

**5. Configure Coolify Resource:**

- Log into Coolify dashboard: `http://<vps-ip>:8000`
- Create new project: "finance-doctor"
- Add resource: Application → Git Repository
- Select GitHub provider and authorize
- Choose repository and main branch
- Enable auto-deployment
- Select build pack: Docker Compose

**6. Add Environment Variables in Coolify:**

Navigate to: Project → Environment Variables

Add each variable from .env.example:

- NODE_ENV = production (Normal)
- DATABASE_PATH = /data/finance.db (Normal)
- SESSION_SECRET = (generate with openssl) (Secret)
- TELEGRAM_BOT_TOKEN = (from BotFather) (Secret)
- FRONTEND_URL = https://yourdomain.com (Normal)

**7. Configure Persistent Storage:**

Navigate to: Project → Persistent Storage

Add two volumes:

- Volume 1: db-data → /data → backend service
- Volume 2: db-backups → /backups → backend service

**8. Configure Domain/Networking:**

Navigate to: Project → Networking

- Set domain or use IP
- Select service to expose: nginx
- Enable HTTPS: Optional (Let's Encrypt auto-provision)
- Save configuration

**9. Initial Manual Deployment:**

```
Coolify dashboard → Your Project → Deploy button
```

Monitor deployment logs:

- Should see "Pulling from GitHub"
- Should see "Building Docker images"
- Should see "Starting containers"
- Should see "Deployment successful"

**10. Verify Application Access:**

```bash
# Test frontend (in browser)
https://yourdomain.com
# Should load Vue app

# Test API health endpoint
curl https://yourdomain.com/api/health
# Should return: {"status":"ok"}

# Check Coolify logs
# Coolify dashboard → Logs tab
# Should see backend startup logs
# Should see Pino JSON logs
```

**11. Test Auto-Deployment Webhook:**

```bash
# Make trivial change to repository
echo "\n<!-- Test Coolify deployment -->" >> README.md

# Commit and push
git add README.md
git commit -m "test: verify coolify auto-deployment"
git push origin main

# Monitor Coolify dashboard
# Should see new deployment triggered within seconds
# Should see updated application after deployment completes
```

**12. Verify Data Persistence:**

```bash
# Create test data via API or Telegram bot
# Note: This requires Epic 2+ to be implemented

# Trigger redeployment (push another commit)
git commit --allow-empty -m "test: verify data persistence"
git push origin main

# After redeployment, verify data still exists
# Database file should persist in /data volume
```

**13. Test Backup Script:**

```bash
# SSH into VPS
ssh user@vps-ip

# Find backend container
docker ps | grep finance-doctor-backend

# Execute backup script manually
docker exec finance-doctor-backend /usr/local/bin/backup.sh

# Verify backup created
docker exec finance-doctor-backend ls -lh /backups

# Should see: finance-YYYYMMDD-HHMMSS.db
```

**14. Test Cron Job (Wait 24 hours or adjust cron schedule):**

```bash
# Option 1: Wait until scheduled time (2am)
# Check logs next day

# Option 2: Temporarily adjust cron schedule for testing
# SSH into container and modify cron schedule
docker exec -it finance-doctor-backend bash
crontab -e
# Change to: */5 * * * * /usr/local/bin/backup.sh (every 5 minutes)
# Exit and wait 5 minutes

# Check backup logs
docker exec finance-doctor-backend cat /var/log/backup.log

# Verify new backups created
docker exec finance-doctor-backend ls -lh /backups
```

**15. Test Backup Retention:**

```bash
# Create fake old backups for testing
docker exec finance-doctor-backend bash -c 'touch -d "35 days ago" /backups/finance-old-test.db'

# Run backup script (includes retention cleanup)
docker exec finance-doctor-backend /usr/local/bin/backup.sh

# Verify old backup deleted
docker exec finance-doctor-backend ls -lh /backups
# finance-old-test.db should be gone
```

**Expected Coolify Deployment Output:**

**Successful Deployment:**

```
[Coolify] Deployment started for finance-doctor
[Coolify] Pulling latest code from GitHub (main branch)
[Coolify] Commit: feat: configure coolify deployment (abc123d)
[Coolify] Building Docker images...
[Docker] Building backend image
[Docker] Step 1/10 : FROM node:22-alpine AS builder
[Docker] Successfully built backend image
[Docker] Building frontend image
[Docker] Step 1/8 : FROM node:22-alpine AS builder
[Docker] Successfully built frontend image
[Coolify] Creating containers...
[Docker] Creating finance-doctor-backend
[Docker] Creating finance-doctor-nginx
[Coolify] Waiting for health checks...
[Docker] backend: healthy
[Coolify] Configuring Traefik routes...
[Traefik] Route configured: yourdomain.com → nginx:80
[Coolify] Deployment successful!
[Coolify] Application accessible at: https://yourdomain.com
[Coolify] Deployment time: 3m 24s
```

**Failed Deployment Example:**

```
[Coolify] Deployment started for finance-doctor
[Coolify] Pulling latest code from GitHub (main branch)
[Coolify] Building Docker images...
[Docker] Building backend image
[Docker] ERROR: Package @fastify/session not found
[Docker] Build failed
[Coolify] Deployment failed: Docker build error
[Coolify] Check logs for details
[Coolify] Rolling back to previous version...
[Coolify] Rollback successful - application still running
```

**16. Verify Webhook Configuration:**

```
GitHub Repository → Settings → Webhooks

Should see webhook:
- URL: https://coolify.yourdomain.com/api/v1/deploy/webhook/<uuid>
- Events: push
- Active: ✓
- Recent Deliveries: Check for successful 200 responses

If webhook missing or failing:
- Copy webhook URL from Coolify dashboard
- Manually add webhook in GitHub settings
- Test webhook: Click "Redeliver" on a recent delivery
```

**17. Test Rollback Capability:**

```bash
# In Coolify dashboard → Deployments tab
# Should see list of previous deployments
# Select previous deployment → Redeploy button
# Verifies you can rollback if new deployment breaks
```

### Previous Story Intelligence

**Story 1.6 Completion Summary (CI/CD Pipeline):**

Story 1.6 successfully set up GitHub Actions CI pipeline with type checking, linting, building, and testing. All quality gates pass before deployment.

**Integration Points for Coolify Deployment:**

**CI/CD Flow:**

```
Developer → Commits code → PR created
    ↓
GitHub Actions runs CI (Story 1.6)
    ↓
CI Passes → Merge allowed
CI Fails → Merge blocked (branch protection)
    ↓
PR merged to main
    ↓
GitHub Actions runs on main branch
    ↓
CI Passes → Code is quality-validated
    ↓
GitHub webhook triggers Coolify (Story 1.7)
    ↓
Coolify deploys to VPS
    ↓
Application live in production
```

**Why CI Runs First:**

- Quality gates prevent broken code from reaching production
- TypeScript errors caught before deployment
- Lint issues fixed before deployment
- Build verification ensures Docker builds will succeed
- Tests validate functionality before users see changes

**Story 1.5 Integration (Docker Configuration):**

Docker setup from Story 1.5 provides foundation for Coolify deployment:

**What Story 1.5 Provided:**

- Multi-stage Dockerfiles for frontend and backend
- docker-compose.yml with service orchestration
- nginx reverse proxy configuration
- Health checks for backend service
- Named volumes for data persistence
- Environment variable configuration

**What Story 1.7 Modifies:**

- Removes `ports:` section (Coolify manages ports)
- Removes `networks:` section (Coolify manages networks)
- Keeps `volumes:` section (Coolify adds UUID prefix)
- Keeps health checks (Coolify monitors these)
- Keeps environment variables as references (Coolify injects values)

**Docker Compose Compatibility:**

Story 1.5 docker-compose.yml was designed for local development with exposed ports:

```yaml
ports:
  - "80:80" # Local development
```

Story 1.7 modifies for Coolify with NO exposed ports:

```yaml
# NO ports section - Coolify manages via Traefik
```

**Important:** Keep separate branches or use environment detection if you want to support both local docker-compose development AND Coolify deployment. For MVP, prioritize Coolify deployment configuration.

**Previous Stories Dependencies:**

This story relies on completion of:

- **Story 1.1:** Monorepo structure with workspace configuration
- **Story 1.2:** Frontend build process (Vite builds)
- **Story 1.3:** Backend build process (TypeScript compilation)
- **Story 1.4:** Database layer with Drizzle ORM and SQLite
- **Story 1.5:** Docker containerization and docker-compose.yml
- **Story 1.6:** CI/CD pipeline for quality gates

All previous stories MUST be complete for Coolify deployment to succeed.

### Git Intelligence Summary

**Recent Commits Analysis:**

```
53edf6c feat: update ci/cd story status
592bbde feat: setup ci/cd on github
7757ba0 feat: setup ci/cd on github
0becd25 feat: update bmad and enable antigravity
b5ec7f8 feat: configure docker containerization
```

**Commit Message Pattern:**

- Prefix: `feat:` for new features
- Format: Imperative mood, lowercase, concise
- Examples: "configure", "setup", "update"

**This Story Should Follow:**

- Commit message: `feat: configure coolify deployment`
- Conventional commits style matches established pattern
- Multiple commits acceptable for iterative work:
  - `feat: modify docker-compose for coolify`
  - `feat: add backup scripts`
  - `feat: update deployment documentation`
  - `feat: configure coolify deployment`

**Documentation Pattern from Previous Stories:**

- README.md updated with setup/deployment instructions
- .env.example updated with variable documentation
- Clear, actionable documentation for developers
- Troubleshooting sections for common issues

**Development Workflow:**

```
Before Story 1.7:
  Developer → Manual Docker deployment on VPS
  or
  Developer → No production deployment yet

After Story 1.7:
  Developer → Push to main → Coolify auto-deploys → Production live
```

### Latest Technical Information

**Coolify v4 Best Practices (January 2026):**

From comprehensive web research and official documentation:

**Docker Compose Compatibility (CRITICAL):**

✅ **DO:**

- Use docker-compose.yml as single source of truth
- Define services with build contexts
- Use environment variable references: `${VAR_NAME}`
- Use named volumes for persistent data
- Configure health checks in docker-compose.yml
- Let Coolify manage ports, networks, and routing

❌ **DON'T:**

- Define `ports:` in docker-compose.yml (Coolify manages ports)
- Define `networks:` in docker-compose.yml (Coolify creates networks)
- Hardcode secrets in docker-compose.yml
- Use external networks or fixed IP addresses
- Rely on host networking mode

Source: [Coolify Docker Compose Build Packs](https://coolify.io/docs/applications/build-packs/docker-compose)

**Persistent Storage Best Practices:**

**Volume Configuration:**

- Source path: Leave EMPTY in Coolify UI (auto-generates)
- Destination path: Set in docker-compose.yml OR Coolify UI
- Coolify adds resource UUID to volume names automatically
- Example: `db-data` → `finance-doctor-<uuid>_db-data`

**SQLite Database Persistence:**

- Mount volume to `/data` directory
- Store database as `/data/finance.db`
- SQLite handles concurrent reads safely (no locking issues)
- Backup via file copy (SQLite supports hot backups)

**Backup Recommendations:**

- Use separate volume for backups (`/backups`)
- Automated backups via cron job inside container
- Manual backups: `scp` or `rsync` from VPS
- Coolify doesn't have built-in SQLite backup automation (as of January 2026)
- Consider future off-site backups for disaster recovery

Sources:

- [Coolify Persistent Storage](https://coolify.io/docs/knowledge-base/persistent-storage)
- [Managing SQLite on VPS with Coolify](https://samperalabs.com/posts/how-to-manage-sqlite-databases-on-a-vps-with-coolify)

**Environment Variables & Secrets Management:**

**Security Best Practices:**

- All secrets managed in Coolify UI (encrypted at rest)
- Variables injected into containers via single .env file
- DO NOT commit .env files to git
- DO NOT define secrets in docker-compose.yml
- Use variable references: `${SESSION_SECRET}` not hardcoded values

**Current Behavior (January 2026):**

- Coolify creates ONE .env file for entire Docker Compose project
- ALL containers see ALL environment variables
- Security consideration: Sensitive variables visible to all services
- For finance-doctor: Acceptable (2 services, nginx doesn't execute code)

**Future Improvement:**

- Feature request exists for per-service environment variables
- Workaround: Use Docker secrets (not yet fully supported in Coolify)

Sources:

- [Coolify Environment Variables](https://coolify.io/docs/knowledge-base/environment-variables)
- [GitHub Issue #7655 - Environment Variable Sharing](https://github.com/coollabsio/coolify/issues/7655)

**Build Cache Optimization:**

**Speed Up Deployments:**

- Disable "Include Source Commit in Build" in Coolify settings
- SOURCE_COMMIT env var changes per commit → invalidates Docker cache
- With cache enabled: 2-3 minute builds (subsequent deployments)
- Without cache: 5-10 minute builds (every deployment)

**Docker Multi-stage Build Efficiency:**

- Story 1.5 already uses multi-stage builds
- Build stage compiles TypeScript
- Runtime stage only includes production dependencies
- Coolify caches Docker layers between deployments

Source: [Simple Coolify Example](https://dev.to/mandrasch/simple-coolify-example-with-docker-compose-github-deployments-53m)

**GitHub Webhook Configuration:**

**Automatic Setup:**

- Coolify automatically creates webhook when connecting GitHub repository
- Webhook URL format: `https://coolify.yourdomain.com/api/v1/deploy/webhook/<resource-uuid>`
- Trigger events: Push to monitored branch (main)

**Manual Verification:**

- GitHub Repo → Settings → Webhooks
- Should see Coolify webhook with green checkmark
- Recent Deliveries: Check for 200 OK responses
- If failing: Verify Coolify URL is publicly accessible

**Webhook Security:**

- Coolify generates unique UUID per resource
- Only push events to configured branch trigger deployment
- No authentication token needed (UUID provides security)

Sources:

- [Coolify GitHub Actions Documentation](https://coolify.io/docs/knowledge-base/git/github/github-actions)
- [Coolify CI/CD Introduction](https://coolify.io/docs/applications/ci-cd/introduction)

**Deployment Health Monitoring:**

**Health Check Configuration:**

- Define in docker-compose.yml (Story 1.5 already has this)
- Coolify monitors health check status
- Deployment waits for healthy status before routing traffic
- Example: Backend health check via `/api/health` endpoint

**What Coolify Monitors:**

- Container status (running, stopped, crashed)
- Health check results (healthy, unhealthy, starting)
- Deployment success/failure
- Build logs and runtime logs

**Logging Best Practices:**

- Log to stdout/stderr (Coolify captures automatically)
- Use structured logging (Pino for Fastify - already configured)
- View logs in Coolify dashboard → Logs tab
- Logs retained for 7 days by default (Coolify configuration)

**Backup and Disaster Recovery:**

**Current Capabilities (January 2026):**

- Automated backups for: PostgreSQL, MySQL, MariaDB, MongoDB
- SQLite backups: Manual implementation required
- Coolify backups: Can backup Coolify configuration and database

**Recommended SQLite Backup Strategy:**

1. **Application-level backups (this story):**

   - Cron job inside backend container
   - Daily backups at 2am with 30-day retention
   - Backups stored in separate Docker volume

2. **VPS-level backups (optional, post-MVP):**

   - VPS provider snapshot backups (weekly)
   - Manual `rsync` to off-site storage
   - Coolify backup for platform configuration

3. **Disaster Recovery Plan:**
   - Database backups in `/backups` volume (recoverable)
   - git repository has all code (redeployable)
   - Coolify configuration documented (reproducible)
   - Environment variables documented in `.env.example`

Sources:

- [Coolify Database Backups](https://coolify.io/docs/databases/backups)
- [Backup Coolify Configuration](https://coolify.io/docs/knowledge-base/how-to/backup-restore-coolify)

**Traefik Reverse Proxy Integration:**

**How Coolify Uses Traefik:**

- Coolify runs Traefik as main reverse proxy
- Traefik routes requests from domain to correct container
- Automatic HTTPS via Let's Encrypt (optional, can enable in Coolify UI)
- Dynamic configuration (Traefik updates when containers change)

**For finance-doctor:**

```
User requests: https://yourdomain.com
    ↓
Traefik (Coolify managed)
    ↓
finance-doctor-nginx container (port 80)
    ↓
Nginx serves frontend OR proxies /api/* to backend
    ↓
finance-doctor-backend container (port 3000)
```

**No Configuration Needed:**

- Coolify handles Traefik configuration automatically
- Just specify domain in Coolify UI
- Traefik routes are created/updated on deployment

**Resource Requirements (VPS Sizing):**

**Minimum Requirements:**

- CPU: 2 cores
- RAM: 4GB (Coolify + application)
- Storage: 20GB (OS + Docker + database)
- Network: Public IP or domain

**Recommended for finance-doctor:**

- CPU: 2 cores (sufficient for household-scale app)
- RAM: 4GB (Coolify: 1-2GB, Application: 1-2GB, OS: 1GB)
- Storage: 40GB (room for Docker images, logs, backups)
- Bandwidth: 1TB/month (more than sufficient)

**Cost Estimate (January 2026):**

- DigitalOcean: $24/month (2 vCPU, 4GB RAM, 80GB SSD)
- Hetzner: €9.50/month (~$10/month, 2 vCPU, 4GB RAM, 40GB SSD)
- Linode: $24/month (2 vCPU, 4GB RAM, 80GB SSD)

### Project Context Reference

**Critical Implementation Rules for Deployment:**

**Environment Variables:**

```bash
# ✅ CORRECT - Variable references in docker-compose.yml
environment:
  - SESSION_SECRET=${SESSION_SECRET}
  - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}

# ❌ WRONG - Hardcoded secrets
environment:
  - SESSION_SECRET=abc123  # NEVER DO THIS
```

**Docker Compose Structure:**

```yaml
# ✅ CORRECT - Coolify-compatible
services:
  backend:
    build: ...
    environment: ...
    volumes: ...
    # NO ports, NO networks

# ❌ WRONG - Will break Coolify
services:
  backend:
    build: ...
    ports:
      - "3000:3000"  # Coolify manages ports
    networks:
      - app-network  # Coolify creates networks
```

**Volume Mounts:**

```yaml
# ✅ CORRECT - Named volumes, Coolify adds UUID
volumes:
  db-data:
    driver: local
  db-backups:
    driver: local

services:
  backend:
    volumes:
      - db-data:/data
      - db-backups:/backups

# ❌ WRONG - Host path binds (not portable)
services:
  backend:
    volumes:
      - /var/lib/finance:/data  # DON'T use host paths in Coolify
```

**Health Checks:**

```yaml
# ✅ CORRECT - Health check for deployment verification
services:
  backend:
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# ❌ WRONG - No health check
services:
  backend:
    # Missing healthcheck - Coolify can't verify deployment success
```

**Backup Script Best Practices:**

```bash
# ✅ CORRECT - Safe SQLite backup
cp /data/finance.db /backups/finance-$(date +%Y%m%d).db

# ✅ CORRECT - Retention cleanup
find /backups -name "finance-*.db" -mtime +30 -delete

# ❌ WRONG - Direct file manipulation while database in use
mv /data/finance.db /backups/  # Can corrupt database

# ❌ WRONG - Backup without verification
cp /data/finance.db /backups/backup.db
# Should check file size > 0 after copy
```

**Cron Job Configuration:**

```bash
# ✅ CORRECT - Explicit path and logging
0 2 * * * /usr/local/bin/backup.sh >> /var/log/backup.log 2>&1

# ✅ CORRECT - Timezone awareness
TZ=America/New_York
0 2 * * * /usr/local/bin/backup.sh

# ❌ WRONG - Relative path (cron has different PATH)
0 2 * * * backup.sh  # May not find script

# ❌ WRONG - No logging
0 2 * * * /usr/local/bin/backup.sh  # Can't debug failures
```

**Security Anti-Patterns:**

❌ **NEVER commit secrets:**

```bash
# ❌ WRONG - Committing .env file
git add .env
git commit -m "Add environment variables"  # SECURITY BREACH

# ✅ CORRECT - Only commit .env.example
git add .env.example
```

❌ **NEVER hardcode tokens:**

```typescript
// ❌ WRONG - Hardcoded token
const bot = new TelegramBot("123456789:ABCdef...", { polling: true });

// ✅ CORRECT - Environment variable
const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN!, { polling: true });
```

❌ **NEVER log secrets:**

```typescript
// ❌ WRONG - Logging sensitive data
logger.info("Session secret:", process.env.SESSION_SECRET);

// ✅ CORRECT - Log without sensitive data
logger.info("Environment variables loaded successfully");
```

**Coolify-Specific Gotchas:**

⚠️ **Port mapping:** Coolify dynamically assigns ports. Don't assume port 80 or 443 in application code.

⚠️ **Network isolation:** Services communicate via service names (`backend`, `nginx`), not `localhost`.

⚠️ **Environment variables:** All variables shared across all containers in project. Prefix sensitive variables or use separate projects.

⚠️ **Build cache:** Disable "Include Source Commit" for faster builds (cache invalidation).

⚠️ **Health checks:** Critical for zero-downtime deployments. Coolify waits for healthy status before routing traffic.

⚠️ **Volume persistence:** Data in volumes survives container restarts and redeployments. Data outside volumes is ephemeral.

### References

All technical details extracted from:

**Epic and Story Context:**

- [Epics.md - Epic 1: Project Foundation & Infrastructure](/_bmad-output/planning-artifacts/epics.md#epic-1-project-foundation--infrastructure)
- [Epics.md - Story 1.7: Configure Coolify Deployment](/_bmad-output/planning-artifacts/epics.md#story-17-configure-coolify-deployment)

**Architecture Decisions:**

- [Architecture.md - Infrastructure & Deployment - CI/CD Strategy](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)
- [Architecture.md - Deployment Strategy - Coolify Configuration](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)
- [Architecture.md - Environment Configuration](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)
- [Architecture.md - Backup Strategy](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)
- [Architecture.md - Logging Strategy](/_bmad-output/planning-artifacts/architecture.md#infrastructure--deployment)

**Project Context:**

- [project-context.md - Development Workflow Rules](/_bmad-output/project-context.md)
- [project-context.md - Docker & Deployment](/_bmad-output/project-context.md)
- [project-context.md - Environment Configuration](/_bmad-output/project-context.md)

**Previous Story Learnings:**

- [Story 1.6 - CI/CD Pipeline with GitHub Actions](/_bmad-output/implementation-artifacts/1-6-set-up-ci-cd-pipeline-with-github-actions.md)
- [Story 1.5 - Docker Containerization](/_bmad-output/implementation-artifacts/1-5-configure-docker-containerization.md)
- [Story 1.4 - Database Layer with Drizzle ORM](/_bmad-output/implementation-artifacts/1-4-set-up-database-layer-with-drizzle-orm.md)
- [Story 1.3 - Backend Configuration](/_bmad-output/implementation-artifacts/1-3-configure-backend-development-environment.md)
- [Story 1.2 - Frontend Configuration](/_bmad-output/implementation-artifacts/1-2-configure-frontend-development-environment.md)
- [Story 1.1 - Monorepo Structure](/_bmad-output/implementation-artifacts/1-1-initialize-monorepo-project-structure.md)

**Web Research (Latest Best Practices - January 2026):**

- [Simple Coolify Example with Docker Compose + GitHub](https://dev.to/mandrasch/simple-coolify-example-with-docker-compose-github-deployments-53m)
- [Coolify GitHub Actions Documentation](https://coolify.io/docs/knowledge-base/git/github/github-actions)
- [Coolify Docker Compose Build Packs](https://coolify.io/docs/applications/build-packs/docker-compose)
- [Coolify Docker Compose Knowledge Base](https://coolify.io/docs/knowledge-base/docker/compose)
- [Deploy Web Apps with Coolify, Docker Compose & GitHub](https://kitemetric.com/blogs/deploying-a-simple-web-app-with-coolify-docker-compose-and-github)
- [Coolify CI/CD Introduction](https://coolify.io/docs/applications/ci-cd/introduction)
- [Coolify Persistent Storage](https://coolify.io/docs/knowledge-base/persistent-storage)
- [How to Manage SQLite Databases on VPS with Coolify](https://samperalabs.com/posts/how-to-manage-sqlite-databases-on-a-vps-with-coolify)
- [Coolify Database Backups](https://coolify.io/docs/databases/backups)
- [Backup and Restore Coolify](https://coolify.io/docs/knowledge-base/how-to/backup-restore-coolify)
- [Coolify Environment Variables](https://coolify.io/docs/knowledge-base/environment-variables)
- [GitHub Issue #7655 - Environment Variables Shared Across Containers](https://github.com/coollabsio/coolify/issues/7655)

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

_To be filled during implementation_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
